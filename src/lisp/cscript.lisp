(defun add-cclasp-sources (target)
  (k:sources target
             #~"kernel/stage/base/0-begin.lisp"
             #~"kernel/stage/base/1-begin.lisp"
             #~"kernel/lsp/prologue.lisp"
             #~"kernel/init.lisp"
             #~"kernel/cmp/runtime-info.lisp"
             #~"kernel/lsp/sharpmacros.lisp"
             #~"kernel/cmp/jit-setup.lisp"
             #~"kernel/clsymbols.lisp"
             #~"kernel/lsp/packages.lisp"
             #~"kernel/lsp/foundation.lisp"
             #~"kernel/lsp/export.lisp"
             #~"kernel/lsp/defmacro.lisp"
             #~"kernel/lsp/helpfile.lisp"
             #~"kernel/lsp/evalmacros.lisp"
             #~"kernel/lsp/claspmacros.lisp"
             #~"kernel/lsp/source-transformations.lisp"
             #~"kernel/lsp/arraylib.lisp"
             #~"kernel/lsp/setf.lisp"
             #~"kernel/lsp/listlib.lisp"
             #~"kernel/lsp/mislib.lisp"
             #~"kernel/lsp/defstruct.lisp"
             #~"kernel/lsp/predlib.lisp"
             #~"kernel/lsp/cdr-5.lisp"
             #~"kernel/lsp/cmuutil.lisp"
             #~"kernel/lsp/seqmacros.lisp"
             #~"kernel/lsp/seq.lisp"
             #~"kernel/lsp/seqlib.lisp"
             #~"kernel/lsp/iolib.lisp"
             #~"kernel/lsp/trace.lisp"
             #~"kernel/lsp/debug.lisp"
             #~"kernel/cmp/cmpexports.lisp"
             #~"kernel/cmp/cmpsetup.lisp"
             #~"kernel/cmp/cmputil.lisp"
             #~"kernel/cmp/cmpintrinsics.lisp"
             #~"kernel/cmp/startup-primitives.lisp"
             #~"kernel/cmp/primitives.lisp"
             #~"kernel/cmp/cmpir.lisp"
             #~"kernel/cmp/debuginfo.lisp"
             #~"kernel/cmp/cmprunall.lisp"
             #~"kernel/cmp/cmpliteral.lisp"
             #~"kernel/cmp/typeq.lisp"
             #~"kernel/cmp/codegen-special-form.lisp"
             #~"kernel/cmp/compile.lisp"
             #~"kernel/cmp/external-clang.lisp"
             #~"kernel/cmp/bytecode-machines.lisp"
             #~"kernel/cmp/bytecode-reference.lisp"
             #@"base-translations.lisp"
             #~"kernel/stage/base/0-end.lisp"
             #~"kernel/cmp/cmpwalk.lisp"
             #~"kernel/lsp/assert.lisp"
             #~"kernel/lsp/iolib.lisp"
             #~"kernel/lsp/numlib.lisp"
             #~"kernel/lsp/describe.lisp"
             #~"kernel/lsp/module.lisp"
             #~"kernel/lsp/loop2.lisp"
             #~"kernel/cmp/disassemble.lisp"
             #~"kernel/cmp/opt/opt.lisp" ; need loop
             #~"kernel/cmp/opt/opt-character.lisp"
             #~"kernel/cmp/opt/opt-number.lisp"
             #~"kernel/cmp/opt/opt-type.lisp"
             #~"kernel/cmp/opt/opt-control.lisp"
             #~"kernel/cmp/opt/opt-sequence.lisp"
             #~"kernel/cmp/opt/opt-cons.lisp"
             #~"kernel/cmp/opt/opt-array.lisp"
             #~"kernel/cmp/opt/opt-object.lisp"
             #~"kernel/cmp/opt/opt-print.lisp"
             #~"kernel/lsp/shiftf-rotatef.lisp"
             #~"kernel/lsp/assorted.lisp"
             #~"kernel/lsp/packlib.lisp"
             #~"kernel/lsp/defpackage.lisp"
             #~"kernel/lsp/format.lisp"
             #~"kernel/lsp/mp.lisp"
             #~"kernel/lsp/atomics.lisp"
             #~"kernel/clos/package.lisp"
             #~"kernel/clos/static-gfs/package.lisp"
             #~"kernel/clos/static-gfs/flag.lisp"
             #~"kernel/clos/static-gfs/constructor.lisp"
             #~"kernel/clos/static-gfs/reinitializer.lisp"
             #~"kernel/clos/static-gfs/changer.lisp"
             #~"kernel/clos/hierarchy.lisp"
             #~"kernel/clos/cpl.lisp"
             #~"kernel/clos/std-slot-value.lisp"
             #~"kernel/clos/slot.lisp"
             #~"kernel/clos/boot.lisp"
             #~"kernel/clos/kernel.lisp"
             #~"kernel/clos/outcome.lisp"
             #~"kernel/clos/discriminate.lisp"
             #~"kernel/clos/dtree.lisp"
             #~"kernel/clos/dtree-graphviz.lisp"
             #~"kernel/clos/effective-accessor.lisp"
             #~"kernel/clos/closfastgf.lisp"
             #~"kernel/clos/satiation.lisp"
             #~"kernel/clos/method.lisp"
             #~"kernel/clos/combin.lisp"
             #~"kernel/clos/std-accessors.lisp"
             #~"kernel/clos/defclass.lisp"
             #~"kernel/clos/slotvalue.lisp"
             #~"kernel/clos/standard.lisp"
             #~"kernel/clos/builtin.lisp"
             #~"kernel/clos/change.lisp"
             #~"kernel/clos/stdmethod.lisp"
             #~"kernel/clos/generic.lisp"
             #~"kernel/clos/fixup.lisp"
             #~"kernel/clos/static-gfs/cell.lisp"
             #~"kernel/clos/static-gfs/effective-method.lisp"
             #~"kernel/clos/static-gfs/svuc.lisp"
             #~"kernel/clos/static-gfs/shared-initialize.lisp"
             #~"kernel/clos/static-gfs/initialize-instance.lisp"
             #~"kernel/clos/static-gfs/allocate-instance.lisp"
             #~"kernel/clos/static-gfs/make-instance.lisp"
             #~"kernel/clos/static-gfs/compute-constructor.lisp"
             #~"kernel/clos/static-gfs/dependents.lisp"
             #~"kernel/clos/static-gfs/compiler-macros.lisp"
             #~"kernel/clos/static-gfs/reinitialize-instance.lisp"
             #~"kernel/clos/static-gfs/update-instance-for-different-class.lisp"
             #~"kernel/clos/static-gfs/change-class.lisp"
             #~"kernel/lsp/source-location.lisp"
             #~"kernel/lsp/defvirtual.lisp"
             #~"kernel/clos/streams.lisp"
             #~"kernel/lsp/pprint.lisp"
             #~"kernel/lsp/format-pprint.lisp"
             #~"kernel/clos/conditions.lisp"
             #~"kernel/clos/print.lisp"
             #~"kernel/clos/sequences.lisp"
             #~"kernel/cmp/compiler-conditions.lisp"
             #~"kernel/lsp/packlib2.lisp"
             #~"kernel/clos/inspect.lisp"
             #~"kernel/clos/telemetry.lisp"
             #~"kernel/lsp/loadltv.lisp"
             :eclector-concrete-syntax-tree
             #~"kernel/cmp/eclector-client.lisp"
             #~"kernel/cmp/fixup-eclector-readtables.lisp"
             #~"kernel/cmp/activate-clasp-readtables-for-eclector.lisp"
             #~"kernel/cmp/define-unicode-tables.lisp"
             #~"kernel/cmp/cmpltv.lisp"
             #~"kernel/cmp/disltv.lisp"
             #~"kernel/cmp/compile-file.lisp"
             #~"kernel/cmp/cmpbundle.lisp"
             #~"kernel/lsp/bytecode-introspect.lisp"
             #~"kernel/lsp/fli.lisp"
             #~"kernel/lsp/posix.lisp"
             #~"modules/sockets/sockets.lisp"
             #~"kernel/lsp/top.lisp"
             #~"kernel/stage/base/1-end.lisp"
             #~"kernel/stage/base/2-begin.lisp"  
             :clasp-cleavir
             #~"kernel/cmp/arguments.lisp"
             #~"kernel/lsp/queue.lisp" ;; cclasp sources
             #~"kernel/lsp/generated-encodings.lisp"
             #~"kernel/lsp/process.lisp"
             #~"kernel/lsp/encodings.lisp"
             #~"kernel/lsp/cltl2.lisp"
             #~"kernel/lsp/macroexpand-all.lisp"
             #~"kernel/lsp/xref.lisp"
             #@"base-immutable.lisp"
             #~"kernel/stage/base/2-end.lisp"
             #~"kernel/cmp/compile-file-parallel.lisp"
             #~"kernel/cleavir/auto-compile.lisp"
             #~"kernel/lsp/top-hook.lisp"))

(defun add-eclasp-sources (target)
  (add-cclasp-sources target)
  (k:sources target
             #~"kernel/stage/extension/0-begin.lisp"
             #@"extension-immutable.lisp"
             #@"extension-translations.lisp"
             #~"modules/asdf/build/asdf.lisp"
             :extension-systems
             #~"kernel/stage/extension/0-end.lisp"))

(add-cclasp-sources :cclasp)

(add-eclasp-sources :eclasp)

(k:sources :nclasp
           #@"runtime-packages.lisp"
           #@"runtime-functions.lisp"
           #@"runtime-variables.lisp"
           #@"type-map.lisp"
           #~"kernel2/contrib-packages.lisp"
           ;; Enough CLOS to call generic functions
           #~"kernel2/clos/method-combination-environment.lisp"
           #~"kernel2/clos/standard-method-combinations.lisp"
           #~"kernel2/clos/hierarchy.lisp"
           #~"kernel2/clos/method-function.lisp"
           #~"kernel2/clos/eql-specializer.lisp"
           #~"kernel2/clos/applicable-methods.lisp"
           #~"kernel2/clos/effective-method.lisp"
           #~"kernel2/clos/outcome.lisp"
           #~"kernel2/clos/slot-value.lisp"
           #~"kernel2/clos/effective-accessor.lisp"
           #~"kernel2/clos/interpreted-discriminator.lisp"
           #~"kernel2/clos/miss.lisp"
           #~"kernel2/clos/check-initargs.lisp"
           #~"kernel2/clos/make.lisp"
           #~"kernel2/clos/print.lisp"
           #~"kernel2/clos/misc.lisp"
           #@"cxx-classes.lisp"
           #~"kernel2/clos/satiate.lisp"
           ;; Library
           #~"kernel2/lsp/debug.lisp"
           #~"kernel2/clos/conditions.lisp"
           #~"kernel2/lsp/assert.lisp"
           #~"kernel2/clos/package.lisp"
           #~"kernel2/lsp/arraylib.lisp"
           #~"kernel2/lsp/numlib.lisp"
           #~"kernel2/lsp/predlib.lisp"
           #~"kernel2/lsp/cdr-5.lisp"
           #~"kernel2/lsp/module.lisp"
           #~"kernel2/clos/streams.lisp"
           #~"kernel2/lsp/pprint.lisp"
           #~"kernel2/lsp/listlib.lisp"
           #~"kernel2/lsp/mislib.lisp"
           #~"kernel2/lsp/seqmacros.lisp"
           #~"kernel2/lsp/seq.lisp"
           #~"kernel2/lsp/seqlib.lisp"
           #~"kernel2/lsp/iolib.lisp"
           #~"kernel2/lsp/trace.lisp"
           #~"kernel2/lsp/assorted.lisp"
           #~"kernel2/lsp/packlib.lisp"
           #~"kernel2/clos/sequences.lisp"
           #~"kernel2/lsp/helpfile.lisp"
           #~"kernel2/lsp/describe.lisp"
           #~"kernel2/lsp/source-location.lisp"
           #~"kernel2/clos/inspect.lisp"
           ;; CLOS part two: defining new generics, classes, etc
           #~"kernel2/clos/change.lisp"
           #~"kernel2/clos/dependent.lisp"
           #~"kernel2/clos/class.lisp"
           #~"kernel2/clos/cpl.lisp"
           #~"kernel2/clos/generic.lisp"
           #~"kernel2/clos/method.lisp"
           ;; compiler
           #~"kernel2/cmp/cmputil.lisp"
           #~"kernel2/cmp/compiler-conditions.lisp"
           #~"kernel2/cmp/compile.lisp"
           #~"kernel2/cmp/walk.lisp"
           #~"kernel2/cmp/bytecode-machines.lisp"
           #~"kernel2/cmp/bytecode-introspect.lisp"
           #~"kernel2/cmp/disassemble.lisp"
           #~"kernel2/cmp/bundle.lisp"
           #~"kernel2/cmp/exports.lisp"
           ;; compiler macros
           #~"kernel2/lsp/source-transformations.lisp"
           #~"kernel2/cmp/compiler-macro.lisp"
           #~"kernel/cmp/opt/opt.lisp"
           #~"kernel/cmp/opt/opt-character.lisp"
           #~"kernel/cmp/opt/opt-number.lisp"
           #~"kernel/cmp/opt/opt-type.lisp"
           #~"kernel/cmp/opt/opt-control.lisp"
           #~"kernel/cmp/opt/opt-sequence.lisp"
           #~"kernel/cmp/opt/opt-cons.lisp"
           #~"kernel/cmp/opt/opt-array.lisp"
           #~"kernel/cmp/opt/opt-object.lisp"
           #~"kernel/cmp/opt/opt-print.lisp"
           ;; macros
           #~"kernel2/lsp/cmuutil.lisp"
           #~"kernel2/lsp/shiftf-rotatef.lisp"
           #~"kernel2/lsp/setf.lisp"
           #~"kernel2/lsp/do.lisp"
           #~"kernel2/lsp/defpackage.lisp"
           #~"kernel2/lsp/format.lisp"
           #~"kernel2/lsp/format-pprint.lisp"
           #~"kernel2/lsp/defmacro.lisp"
           #~"kernel2/lsp/evalmacros.lisp"
           #~"kernel2/lsp/defstruct.lisp"
           #~"kernel2/lsp/loop2.lisp"
           #~"kernel2/lsp/sharpmacros.lisp"
           #~"kernel2/lsp/mp.lisp"
           #~"kernel2/lsp/atomics.lisp"
           #~"kernel2/lsp/mp-package.lisp"
           #~"kernel2/clos/define-method-combination.lisp"
           #~"kernel2/lsp/special-operators.lisp"
           ;; some extensions
           #~"kernel2/lsp/encodings.lisp"
           #~"kernel2/lsp/posix.lisp"
           #~"kernel2/lsp/ext-package.lisp"
           #~"kernel2/lsp/process.lisp"
           ;; toplevel
           #~"kernel2/lsp/top.lisp"
           #~"kernel2/lsp/top-hook.lisp"
           #~"kernel2/install-delayed-macros.lisp"
           :ecclesia
           ;; logical pathname translation
           #@"base-translations.lisp"
           #@"extension-translations.lisp"
           ;; file compiler
           :eclector-concrete-syntax-tree
           #~"kernel2/cmp/variables.lisp"
           #~"kernel2/clos/make-load-form.lisp"
           #~"kernel2/cmp/eclector.lisp"
           #~"kernel/cmp/startup-primitives.lisp"
           #~"kernel2/cmp/cmpltv.lisp"
           #~"kernel2/cmp/compile-file.lisp"
           ;; native compiler
           #~"kernel2/cleavir/literal-package.lisp"
           #@"runtime-info.lisp"
           #~"kernel2/cleavir/runtime-info.lisp"
           #~"kernel2/cleavir/jit-setup.lisp"
           #~"kernel/cmp/cmpsetup.lisp"
           #~"kernel2/cleavir/cmpintrinsics.lisp"
           #~"kernel2/cleavir/primitives.lisp"
           #~"kernel2/cleavir/cmpir.lisp"
           #~"kernel/cmp/debuginfo.lisp"
           #~"kernel/cmp/cmprunall.lisp"
           #~"kernel2/cleavir/cmpliteral.lisp"
           #~"kernel/cmp/typeq.lisp"
           #~"kernel/cmp/codegen-special-form.lisp"
           :clasp-cleavir
           #~"kernel/cmp/arguments.lisp"
           #~"kernel2/cleavir/compile-file.lisp"
           #~"kernel2/cleavir/atomics.lisp"
           #~"kernel/lsp/queue.lisp"
           #~"kernel/cmp/compile-file-parallel.lisp"
           #@"fli-specs.lisp"
           #~"kernel2/lsp/fli.lisp"
           #~"kernel/lsp/cltl2.lisp"
           #~"kernel/lsp/macroexpand-all.lisp"
           #~"kernel/cleavir/auto-compile.lisp")

(k:sources :extension-translations
           :extension-systems)

(k:sources :modules
           #~"modules/asdf/build/asdf.lisp"
           #~"modules/serve-event/serve-event.lisp")

(k:sources :install-code
           #~"modules/"
           #~"kernel/contrib/Acclimation/"
           #~"kernel/contrib/alexandria/"
           #~"kernel/contrib/Cleavir/"
           #~"kernel/contrib/closer-mop/"
           #~"kernel/contrib/Concrete-Syntax-Tree/"
           #~"kernel/contrib/Eclector/")

(k:sources :install-extension-code
           #~"kernel/contrib/anaphora/"
           #~"kernel/contrib/architecture.builder-protocol/"
           #~"kernel/contrib/array-utils/"
           #~"kernel/contrib/babel/"
           #~"kernel/contrib/bordeaux-threads/"
           #~"kernel/contrib/cffi/"
           #~"kernel/contrib/cl-markup/"
           #~"kernel/contrib/cl-netcdf/"
           #~"kernel/contrib/cl-ppcre/"
           #~"kernel/contrib/cl-svg/"
           #~"kernel/contrib/documentation-utils/"
           #~"kernel/contrib/esrap/"
           #~"kernel/contrib/global-vars/"
           #~"kernel/contrib/let-plus/"
           #~"kernel/contrib/lparallel/"
           #~"kernel/contrib/mgl-pax/"
           #~"kernel/contrib/parser.common-rules/"
           #~"kernel/contrib/plump/"
           #~"kernel/contrib/split-sequence/"
           #~"kernel/contrib/static-vectors/"
           #~"kernel/contrib/trivial-features/"
           #~"kernel/contrib/trivial-garbage/"
           #~"kernel/contrib/trivial-http/"
           #~"kernel/contrib/trivial-indent/"
           #~"kernel/contrib/trivial-with-current-source-form/"
           #~"kernel/contrib/usocket/")

(k:sources :analyzer
           :clasp-analyzer)

(k:sources :vm-header
           #~"kernel/cmp/startup-primitives.lisp"
           #~"kernel/cmp/bytecode-machines.lisp")
