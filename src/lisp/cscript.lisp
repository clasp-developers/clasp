(defun add-nclasp-sources (target)
  (k:sources target
             #@"runtime-packages.lisp"
             #@"runtime-functions.lisp"
             #@"runtime-variables.lisp"
             #@"type-map.lisp"
             #~"kernel2/contrib-packages.lisp"
             ;; Enough CLOS to call generic functions
             #~"kernel2/clos/method-combination-environment.lisp"
             #~"kernel2/clos/standard-method-combinations.lisp"
             #~"kernel2/clos/hierarchy.lisp"
             #~"kernel2/clos/method-function.lisp"
             #~"kernel2/clos/eql-specializer.lisp"
             #~"kernel2/clos/applicable-methods.lisp"
             #~"kernel2/clos/effective-method.lisp"
             #~"kernel2/clos/outcome.lisp"
             #~"kernel2/clos/slot-value.lisp"
             #~"kernel2/clos/effective-accessor.lisp"
             #~"kernel2/clos/interpreted-discriminator.lisp"
             #~"kernel2/clos/miss.lisp"
             #~"kernel2/clos/check-initargs.lisp"
             #~"kernel/clos/static-gfs/package.lisp"
             #~"kernel/clos/static-gfs/flag.lisp"
             #~"kernel2/clos/make.lisp"
             #~"kernel2/clos/print.lisp"
             #~"kernel2/clos/misc.lisp"
             #@"cxx-classes.lisp"
             #~"kernel2/clos/base-satiation.lisp"
             ;; Library
             #~"kernel2/lsp/debug.lisp"
             #~"kernel2/clos/conditions.lisp"
             #~"kernel2/lsp/assert.lisp"
             #~"kernel2/clos/package.lisp"
             #~"kernel2/lsp/ext-package.lisp"
             #~"kernel2/lsp/arraylib.lisp"
             #~"kernel2/lsp/numlib.lisp"
             #~"kernel2/lsp/predlib.lisp"
             #~"kernel2/lsp/cdr-5.lisp"
             #~"kernel2/lsp/module.lisp"
             #~"kernel2/clos/streams.lisp"
             #~"kernel2/lsp/pprint.lisp"
             #~"kernel2/lsp/listlib.lisp"
             #~"kernel2/lsp/mislib.lisp"
             #~"kernel2/lsp/seqmacros.lisp"
             #~"kernel2/lsp/seq.lisp"
             #~"kernel2/lsp/seqlib.lisp"
             #~"kernel2/lsp/iolib.lisp"
             #~"kernel2/lsp/trace.lisp"
             #~"kernel2/lsp/assorted.lisp"
             #~"kernel2/lsp/packlib.lisp"
             #~"kernel2/clos/sequences.lisp"
             #~"kernel2/lsp/helpfile.lisp"
             #~"kernel2/lsp/describe.lisp"
             #~"kernel2/lsp/source-location.lisp"
             #~"kernel2/clos/inspect.lisp"
             ;; CLOS part two: defining new generics, classes, etc
             #~"kernel2/clos/change.lisp"
             #~"kernel2/clos/dependent.lisp"
             #~"kernel2/clos/class.lisp"
             #~"kernel2/clos/cpl.lisp"
             #~"kernel2/clos/generic.lisp"
             #~"kernel2/clos/method.lisp"
             ;; compiler
             #~"kernel2/cmp/cmputil.lisp"
             #~"kernel2/cmp/compiler-conditions.lisp"
             #~"kernel2/cmp/compile.lisp"
             #~"kernel2/cmp/walk.lisp"
             #~"kernel2/cmp/bytecode-machines.lisp"
             #~"kernel2/cmp/bytecode-introspect.lisp"
             #~"kernel2/cmp/disassemble.lisp"
             #~"kernel2/cmp/bundle.lisp"
             #~"kernel2/cmp/exports.lisp"
             ;; compiler macros
             #~"kernel2/lsp/source-transformations.lisp"
             #~"kernel2/cmp/compiler-macro.lisp"
             #~"kernel/cmp/opt/opt.lisp"
             #~"kernel/cmp/opt/opt-character.lisp"
             #~"kernel/cmp/opt/opt-number.lisp"
             #~"kernel/cmp/opt/opt-type.lisp"
             #~"kernel/cmp/opt/opt-control.lisp"
             #~"kernel/cmp/opt/opt-sequence.lisp"
             #~"kernel/cmp/opt/opt-cons.lisp"
             #~"kernel/cmp/opt/opt-array.lisp"
             #~"kernel/cmp/opt/opt-object.lisp"
             #~"kernel/cmp/opt/opt-print.lisp"
             ;; macros
             #~"kernel2/lsp/cmuutil.lisp"
             #~"kernel2/lsp/shiftf-rotatef.lisp"
             #~"kernel2/lsp/setf.lisp"
             #~"kernel2/lsp/do.lisp"
             #~"kernel2/lsp/defpackage.lisp"
             #~"kernel2/lsp/format.lisp"
             #~"kernel2/lsp/format-pprint.lisp"
             #~"kernel2/lsp/defmacro.lisp"
             #~"kernel2/lsp/evalmacros.lisp"
             #~"kernel2/lsp/defstruct.lisp"
             #~"kernel2/lsp/loop2.lisp"
             #~"kernel2/lsp/sharpmacros.lisp"
             #~"kernel2/lsp/mp.lisp"
             #~"kernel2/lsp/atomics.lisp"
             #~"kernel2/lsp/mp-package.lisp"
             #~"kernel2/clos/atomics.lisp"
             #~"kernel2/clos/define-method-combination.lisp"
             #~"kernel2/lsp/special-operators.lisp"
             ;; some extensions
             #~"kernel/lsp/defvirtual.lisp"
             #~"kernel2/clos/telemetry.lisp"
             #~"kernel2/cmp/xref.lisp"
             #@"generated-encodings.lisp"
             #~"kernel2/lsp/encodings.lisp"
             #~"kernel2/lsp/posix.lisp"
             #~"kernel2/lsp/process.lisp"
             ;; toplevel
             #~"kernel2/lsp/top.lisp"
             #~"kernel2/lsp/top-hook.lisp"
             #~"kernel2/install-delayed-macros.lisp"
             :ecclesia
             ;; logical pathname translation
             #@"base-translations.lisp"
             #@"extension-translations.lisp"
             #~"modules/sockets/sockets.lisp"
             #@"base-immutable.lisp"
             #@"extension-immutable.lisp"
             ;; CLOS part three: compiled discriminators, user satiation, static GFs
             #~"kernel2/clos/compiled-discriminator.lisp"
             #~"kernel2/clos/satiation.lisp"
             #~"kernel/clos/static-gfs/package.lisp"
             #~"kernel/clos/static-gfs/flag.lisp"
             #~"kernel/clos/static-gfs/constructor.lisp"
             #~"kernel/clos/static-gfs/cell.lisp"
             #~"kernel/clos/static-gfs/effective-method.lisp"
             #~"kernel/clos/static-gfs/svuc.lisp"
             #~"kernel/clos/static-gfs/shared-initialize.lisp"
             #~"kernel/clos/static-gfs/initialize-instance.lisp"
             #~"kernel/clos/static-gfs/allocate-instance.lisp"
             #~"kernel/clos/static-gfs/make-instance.lisp"
             #~"kernel/clos/static-gfs/compute-constructor.lisp"
             #~"kernel/clos/static-gfs/dependents.lisp"
             #~"kernel/clos/static-gfs/compiler-macros.lisp"
             ;; file compiler
             :eclector-concrete-syntax-tree
             #~"kernel2/cmp/variables.lisp"
             #~"kernel2/clos/make-load-form.lisp"
             #~"kernel2/cmp/eclector.lisp"
             #~"kernel/cmp/startup-primitives.lisp"
             #~"kernel2/cmp/cmpltv.lisp"
             #~"kernel2/cmp/compile-file.lisp"
             ;; native compiler
             #~"kernel2/cleavir/literal-package.lisp"
             #@"runtime-info.lisp"
             #~"kernel2/cleavir/runtime-info.lisp"
             #~"kernel2/cleavir/jit-setup.lisp"
             #~"kernel/cmp/cmpsetup.lisp"
             #~"kernel2/cleavir/cmpintrinsics.lisp"
             #~"kernel2/cleavir/primitives.lisp"
             #~"kernel2/cleavir/cmpir.lisp"
             #~"kernel/cmp/debuginfo.lisp"
             #~"kernel/cmp/cmprunall.lisp"
             #~"kernel2/cleavir/cmpliteral.lisp"
             #~"kernel/cmp/typeq.lisp"
             #~"kernel/cmp/codegen-special-form.lisp"
             :clasp-cleavir
             #~"kernel/cmp/arguments.lisp"
             #~"kernel2/cleavir/compile-file.lisp"
             #~"kernel2/cleavir/atomics.lisp"
             #~"kernel2/cleavir/disassemble.lisp"
             #~"kernel/lsp/queue.lisp"
             #~"kernel/cmp/compile-file-parallel.lisp"
             #@"fli-specs.lisp"
             #~"kernel2/lsp/fli.lisp"
             #~"kernel/lsp/cltl2.lisp"
             #~"kernel/lsp/macroexpand-all.lisp"
             #~"kernel2/cmp/external-clang.lisp"
             #~"kernel/cleavir/auto-compile.lisp"))

(defun add-eclasp-sources (target)
  (add-nclasp-sources target)
  (k:sources target
             #~"kernel/stage/extension/0-begin.lisp"
             #@"extension-immutable.lisp"
             #@"extension-translations.lisp"
             #~"modules/asdf/build/asdf.lisp"
             :extension-systems
             #~"kernel/stage/extension/0-end.lisp"))

(add-nclasp-sources :nclasp)

(add-eclasp-sources :eclasp)


(k:sources :extension-translations
           :extension-systems)

(k:sources :modules
           #~"modules/asdf/build/asdf.lisp"
           #~"modules/serve-event/serve-event.lisp")

(k:sources :install-code
           #~"modules/"
           #~"kernel/contrib/Acclimation/"
           #~"kernel/contrib/alexandria/"
           #~"kernel/contrib/Cleavir/"
           #~"kernel/contrib/closer-mop/"
           #~"kernel/contrib/Concrete-Syntax-Tree/"
           #~"kernel/contrib/Eclector/")

(k:sources :install-extension-code
           #~"kernel/contrib/anaphora/"
           #~"kernel/contrib/architecture.builder-protocol/"
           #~"kernel/contrib/array-utils/"
           #~"kernel/contrib/babel/"
           #~"kernel/contrib/bordeaux-threads/"
           #~"kernel/contrib/cffi/"
           #~"kernel/contrib/cl-markup/"
           #~"kernel/contrib/cl-netcdf/"
           #~"kernel/contrib/cl-ppcre/"
           #~"kernel/contrib/cl-svg/"
           #~"kernel/contrib/documentation-utils/"
           #~"kernel/contrib/esrap/"
           #~"kernel/contrib/global-vars/"
           #~"kernel/contrib/let-plus/"
           #~"kernel/contrib/lparallel/"
           #~"kernel/contrib/mgl-pax/"
           #~"kernel/contrib/parser.common-rules/"
           #~"kernel/contrib/plump/"
           #~"kernel/contrib/split-sequence/"
           #~"kernel/contrib/static-vectors/"
           #~"kernel/contrib/trivial-features/"
           #~"kernel/contrib/trivial-garbage/"
           #~"kernel/contrib/trivial-http/"
           #~"kernel/contrib/trivial-indent/"
           #~"kernel/contrib/trivial-with-current-source-form/"
           #~"kernel/contrib/usocket/")

(k:sources :analyzer
           :clasp-analyzer)

(k:sources :vm-header
           #~"kernel/cmp/startup-primitives.lisp"
           #~"kernel/cmp/bytecode-machines.lisp")
